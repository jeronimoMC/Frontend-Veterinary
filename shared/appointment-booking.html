<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetUni - Agendar Cita</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/sweetalert2.min.css">
    <style>

         body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #F9FAFB 0%, #E5E7EB 100%);
            color: #111827;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .booking-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #E5E7EB;
            text-align: center;
            position: relative;
        }

        .back-button {
            position: absolute;
            left: 30px;
            top: 30px;
            width: 50px;
            height: 50px;
            background: #F3F4F6;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #E5E7EB;
            transform: translateY(-2px);
        }

        .header-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #2E7D5E, #1E3A8A);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #6B7280;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: #2E7D5E;
            color: white;
        }

        .progress-step.completed {
            background: #10B981;
            color: white;
        }

        .progress-step.pending {
            background: #F3F4F6;
            color: #6B7280;
        }

        .progress-line {
            width: 60px;
            height: 2px;
            background: #E5E7EB;
            position: relative;
        }

        .progress-line.completed {
            background: #10B981;
        }

        .booking-form {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #E5E7EB;
            overflow: hidden;
        }

        .form-step {
            display: none;
            padding: 40px;
        }

        .form-step.active {
            display: block;
        }

        .step-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-subtitle {
            color: #6B7280;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-label.required::after {
            content: ' *';
            color: #EF4444;
        }

        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #F9FAFB;
        }

        .form-input:focus {
            outline: none;
            border-color: #2E7D5E;
            box-shadow: 0 0 0 3px rgba(46, 125, 94, 0.1);
            background: white;
        }

        .form-select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: #2E7D5E;
            box-shadow: 0 0 0 3px rgba(46, 125, 94, 0.1);
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            border: 2px solid #E5E7EB;
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .service-card:hover {
            border-color: #2E7D5E;
            background: #F9FAFB;
            transform: translateY(-2px);
        }

        .service-card.selected {
            border-color: #2E7D5E;
            background: linear-gradient(135deg, #ECFDF5, #D1FAE5);
        }

        .service-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #2E7D5E, #1E3A8A);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: white;
        }

        .service-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .service-description {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .service-price {
            color: #2E7D5E;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .service-duration {
            color: #9CA3AF;
            font-size: 0.85rem;
        }

        .calendar-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .calendar {
            background: #F9FAFB;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #E5E7EB;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .nav-button {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-button:hover {
            background: #2E7D5E;
            color: white;
        }

        .calendar-month {
            font-size: 1.2rem;
            font-weight: 600;
            color: #111827;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day-header {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #6B7280;
            font-size: 0.8rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: #E5E7EB;
        }

        .calendar-day.available {
            background: white;
            color: #111827;
        }

        .calendar-day.available:hover {
            background: #2E7D5E;
            color: white;
        }

        .calendar-day.selected {
            background: #2E7D5E;
            color: white;
        }

        .calendar-day.unavailable {
            color: #D1D5DB;
            cursor: not-allowed;
        }

        .calendar-day.today {
            background: #FEF3C7;
            color: #92400E;
            font-weight: 600;
        }

        .time-slots {
            background: white;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #E5E7EB;
        }

        .time-slots-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .time-slot {
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .time-slot:hover {
            border-color: #2E7D5E;
            background: #F9FAFB;
        }

        .time-slot.selected {
            background: #2E7D5E;
            color: white;
            border-color: #2E7D5E;
        }

        .time-slot.unavailable {
            background: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }

        .summary-section {
            background: #F9FAFB;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #E5E7EB;
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #E5E7EB;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1rem;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 2px solid #E5E7EB;
        }

        .summary-label {
            color: #6B7280;
        }

        .summary-value {
            color: #111827;
            font-weight: 500;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #E5E7EB;
        }

        .btn {
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: #F3F4F6;
            color: #6B7280;
        }

        .btn-secondary:hover {
            background: #E5E7EB;
            color: #374151;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2E7D5E, #1E3A8A);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 125, 94, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .emergency-banner {
            background: linear-gradient(135deg, #FEF2F2, #FEE2E2);
            border: 2px solid #FECACA;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .emergency-title {
            color: #991B1B;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .emergency-text {
            color: #B91C1C;
            margin-bottom: 15px;
        }

        .emergency-contact {
            background: #EF4444;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .emergency-contact:hover {
            background: #DC2626;
        }

        .form-note {
            background: #FFFBEB;
            border: 1px solid #FDE68A;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .note-title {
            color: #92400E;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .note-text {
            color: #D97706;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        @media (max-width: 1024px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }

            .time-slots {
                margin-top: 20px;
            }
        }

        @media (max-width: 768px) {
            .booking-container {
                padding: 15px;
            }

            .back-button {
                position: static;
                margin-bottom: 20px;
            }

            .form-step {
                padding: 25px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .service-grid {
                grid-template-columns: 1fr;
            }

            .time-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="booking-container">
        <!-- Header -->
        <div class="header">
            <button class="back-button" onclick="goBack()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#6B7280">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </button>
            
            <div class="header-icon">📅</div>
            <h1 class="page-title">Agendar Cita</h1>
            <p class="page-subtitle">Programa una cita veterinaria para el cuidado de tu mascota</p>
            
            <div class="progress-indicator">
                <div class="progress-step active" id="step1-indicator">1</div>
                <div class="progress-line" id="line1"></div>
                <div class="progress-step pending" id="step2-indicator">2</div>
                <div class="progress-line" id="line2"></div>
                <div class="progress-step pending" id="step3-indicator">3</div>
                <div class="progress-line" id="line3"></div>
                <div class="progress-step pending" id="step4-indicator">4</div>
            </div>
        </div>

        <!-- Emergency Banner -->
        <div class="emergency-banner">
            <h3 class="emergency-title">¿Necesitas Atención Urgente?</h3>
            <p class="emergency-text">Si tu mascota tiene una emergencia médica, no esperes. Contáctanos inmediatamente.</p>
            <a href="tel:+573001234567" class="emergency-contact">
                🚨 Llamar Urgencias: +57 300 123 4567
            </a>
        </div>

        <!-- Booking Form -->
        <form class="booking-form" id="bookingForm">
            <!-- Step 1: Pet Selection -->
            <div class="form-step active" id="step1">
                <h2 class="step-title">
                    <span>🐾</span>
                    Selecciona tu Mascota
                </h2>
                <p class="step-subtitle">Elige cuál de tus mascotas necesita atención veterinaria</p>
                
                <div class="form-note">
                    <div class="note-title">📋 Información Importante</div>
                    <div class="note-text">
                        Si tu mascota no aparece en la lista, puedes registrarla desde tu perfil antes de continuar con la cita.
                    </div>
                </div>

                <div class="service-grid">
                    <div class="service-card" onclick="selectPet('max')" data-pet="max">
                        <div class="service-icon">🐕</div>
                        <div class="service-name">Max</div>
                        <div class="service-description">
                            Golden Retriever • 3 años • 28 kg<br>
                            Última consulta: 5 de Junio, 2025
                        </div>
                        <div class="service-price">Activo</div>
                        <div class="service-duration">Todas las vacunas al día</div>
                    </div>
                    
                    <div class="service-card" onclick="selectPet('luna')" data-pet="luna">
                        <div class="service-icon">🐱</div>
                        <div class="service-name">Luna</div>
                        <div class="service-description">
                            Siamés • 2 años • 4 kg<br>
                            Última consulta: 20 de Mayo, 2025
                        </div>
                        <div class="service-price">Activo</div>
                        <div class="service-duration">Vacuna pendiente</div>
                    </div>
                    
                    <div class="service-card" onclick="showRegisterPet()" data-pet="new">
                        <div class="service-icon">➕</div>
                        <div class="service-name">Registrar Nueva Mascota</div>
                        <div class="service-description">
                            Si tu mascota no aparece en la lista, puedes registrarla aquí
                        </div>
                        <div class="service-price">Nuevo Registro</div>
                        <div class="service-duration">Solo perros y gatos</div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Service Selection -->
            <div class="form-step" id="step2">
                <h2 class="step-title">
                    <span>🏥</span>
                    Selecciona el Servicio
                </h2>
                <p class="step-subtitle">Elige el tipo de atención que necesita tu mascota</p>
                
                <div class="service-grid">
                    <div class="service-card" onclick="selectService('consultation')" data-service="consultation">
                        <div class="service-icon">🩺</div>
                        <div class="service-name">Consulta General</div>
                        <div class="service-description">
                            Examen médico completo para evaluar el estado de salud general
                        </div>
                        <div class="service-price">$45.000</div>
                        <div class="service-duration">45 minutos</div>
                    </div>
                    
                    <div class="service-card" onclick="selectService('vaccination')" data-service="vaccination">
                        <div class="service-icon">💉</div>
                        <div class="service-name">Vacunación</div>
                        <div class="service-description">
                            Protección completa con vacunas actualizadas según calendario
                        </div>
                        <div class="service-price">$35.000</div>
                        <div class="service-duration">30 minutos</div>
                    </div>
                    
                    <div class="service-card" onclick="selectService('grooming')" data-service="grooming">
                        <div class="service-icon">✂️</div>
                        <div class="service-name">Grooming</div>
                        <div class="service-description">
                            Servicio completo de estética y bienestar para tu mascota
                        </div>
                        <div class="service-price">$45.000</div>
                        <div class="service-duration">90 minutos</div>
                    </div>
                    
                    <div class="service-card" onclick="selectService('laboratory')" data-service="laboratory">
                        <div class="service-icon">🔬</div>
                        <div class="service-name">Laboratorio</div>
                        <div class="service-description">
                            Análisis clínicos especializados para diagnóstico preciso
                        </div>
                        <div class="service-price">$55.000</div>
                        <div class="service-duration">30 minutos</div>
                    </div>
                    
                    <div class="service-card" onclick="selectService('surgery')" data-service="surgery">
                        <div class="service-icon">⚕️</div>
                        <div class="service-name">Cirugía</div>
                        <div class="service-description">
                            Procedimientos quirúrgicos especializados (requiere evaluación previa)
                        </div>
                        <div class="service-price">Desde $150.000</div>
                        <div class="service-duration">Variable</div>
                    </div>
                    
                    <div class="service-card" onclick="selectService('emergency')" data-service="emergency">
                        <div class="service-icon">🚨</div>
                        <div class="service-name">Urgencias</div>
                        <div class="service-description">
                            Atención médica inmediata para emergencias veterinarias
                        </div>
                        <div class="service-price">$80.000</div>
                        <div class="service-duration">Inmediato</div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Date & Time Selection -->
            <div class="form-step" id="step3">
                <h2 class="step-title">
                    <span>📅</span>
                    Fecha y Hora
                </h2>
                <p class="step-subtitle">Selecciona cuándo te gustaría programar la cita</p>
                
                <div class="calendar-container">
                    <div class="calendar">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button type="button" class="nav-button" onclick="previousMonth()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                                    </svg>
                                </button>
                                <button type="button" class="nav-button" onclick="nextMonth()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="calendar-month" id="currentMonth">Junio 2025</div>
                        </div>
                        
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar days will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="time-slots">
                        <div class="time-slots-header">Horarios Disponibles</div>
                        <div class="time-grid" id="timeSlots">
                            <div class="time-slot" onclick="selectTime('09:00')">09:00 AM</div>
                            <div class="time-slot" onclick="selectTime('09:30')">09:30 AM</div>
                            <div class="time-slot" onclick="selectTime('10:00')">10:00 AM</div>
                            <div class="time-slot" onclick="selectTime('10:30')">10:30 AM</div>
                            <div class="time-slot" onclick="selectTime('11:00')">11:00 AM</div>
                            <div class="time-slot unavailable">11:30 AM</div>
                            <div class="time-slot" onclick="selectTime('14:00')">02:00 PM</div>
                            <div class="time-slot" onclick="selectTime('14:30')">02:30 PM</div>
                            <div class="time-slot" onclick="selectTime('15:00')">03:00 PM</div>
                            <div class="time-slot" onclick="selectTime('15:30')">03:30 PM</div>
                            <div class="time-slot" onclick="selectTime('16:00')">04:00 PM</div>
                            <div class="time-slot" onclick="selectTime('16:30')">04:30 PM</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="form-step" id="step4">
                <h2 class="step-title">
                    <span>✅</span>
                    Confirmar Cita
                </h2>
                <p class="step-subtitle">Revisa los detalles de tu cita antes de confirmar</p>
                
                <div class="summary-section">
                    <h3 class="summary-title">Resumen de la Cita</h3>
                    
                    <div class="summary-item">
                        <span class="summary-label">Mascota:</span>
                        <span class="summary-value" id="summaryPet">Max - Golden Retriever</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Servicio:</span>
                        <span class="summary-value" id="summaryService">Consulta General</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Fecha:</span>
                        <span class="summary-value" id="summaryDate">15 de Junio, 2025</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Hora:</span>
                        <span class="summary-value" id="summaryTime">10:30 AM</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Duración:</span>
                        <span class="summary-value" id="summaryDuration">45 minutos</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Veterinario:</span>
                        <span class="summary-value" id="summaryVet">Dr. Rosa Martínez</span>
                    </div>
                    
                    <div class="summary-item">
                        <span class="summary-label">Total a Pagar:</span>
                        <span class="summary-value" id="summaryPrice">$45.000</span>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Notas Adicionales (Opcional)</label>
                        <textarea class="form-input" rows="4" placeholder="Describe cualquier síntoma, comportamiento o información relevante..."></textarea>
                    </div>
                </div>
                
                <div class="form-note">
                    <div class="note-title">📋 Política de Cancelación</div>
                    <div class="note-text">
                        • Las citas pueden cancelarse o modificarse hasta 2 horas antes<br>
                        • Las citas no confirmadas 24 horas antes serán canceladas automáticamente<br>
                        • En caso de emergencia, contáctanos directamente
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Anterior
                </button>
                
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()" disabled>
                    <span id="nextBtnText">Siguiente</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                    </svg>
                </button>
            </div>
        </form>
    </div>

    <script src="../js/navigation.js"></script>
    <script src="../js/sweetalert2.min.js"></script>
    <script src="../js/components/appointment-booking.js"></script>
    <script>
        // Variables globales
        let currentStep = 1;
        let selectedPet = null;
        let selectedService = null;
        let selectedDate = null;
        let selectedTime = null;
        
        // Datos de servicios
        const services = {
            'consultation': {
                name: 'Consulta General',
                price: 45000,
                duration: '45 minutos',
                vet: 'Dr. Rosa Martínez'
            },
            'vaccination': {
                name: 'Vacunación',
                price: 35000,
                duration: '30 minutos',
                vet: 'Dr. Carlos López'
            },
            'grooming': {
                name: 'Grooming',
                price: 45000,
                duration: '90 minutos',
                vet: 'Especialista Ana'
            },
            'laboratory': {
                name: 'Laboratorio',
                price: 55000,
                duration: '30 minutos',
                vet: 'Dr. María García'
            },
            'surgery': {
                name: 'Cirugía',
                price: 150000,
                duration: 'Variable',
                vet: 'Dr. José Hernández'
            },
            'emergency': {
                name: 'Urgencias',
                price: 80000,
                duration: 'Inmediato',
                vet: 'Veterinario de Guardia'
            }
        };

        function goBack() {
            if (currentStep > 1) {
                previousStep();
            } else {
                window.history.back();
            }
        }

        function selectPet(petId) {
            // Remover selección previa
            document.querySelectorAll('.service-card[data-pet]').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Seleccionar nueva mascota
            document.querySelector(`[data-pet="${petId}"]`).classList.add('selected');
            selectedPet = petId;
            
            // Habilitar botón siguiente
            updateNextButton();
        }

        function selectService(serviceId) {
            // Remover selección previa
            document.querySelectorAll('.service-card[data-service]').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Seleccionar nuevo servicio
            document.querySelector(`[data-service="${serviceId}"]`).classList.add('selected');
            selectedService = serviceId;
            
            // Habilitar botón siguiente
            updateNextButton();
        }

        function selectTime(time) {
            if (event.target.classList.contains('unavailable')) return;
            
            // Remover selección previa
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Seleccionar nuevo horario
            event.target.classList.add('selected');
            selectedTime = time;
            
            // Habilitar botón siguiente
            updateNextButton();
        }

        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            let canProceed = false;
            
            switch(currentStep) {
                case 1:
                    canProceed = selectedPet !== null;
                    break;
                case 2:
                    canProceed = selectedService !== null;
                    break;
                case 3:
                    canProceed = selectedDate !== null && selectedTime !== null;
                    break;
                case 4:
                    canProceed = true;
                    break;
            }
            
            nextBtn.disabled = !canProceed;
        }

        function nextStep() {
            if (currentStep < 4) {
                // Ocultar paso actual
                document.getElementById(`step${currentStep}`).classList.remove('active');
                
                // Actualizar indicadores
                document.getElementById(`step${currentStep}-indicator`).classList.remove('active');
                document.getElementById(`step${currentStep}-indicator`).classList.add('completed');
                if (currentStep < 4) {
                    document.getElementById(`line${currentStep}`).classList.add('completed');
                }
                
                // Mostrar siguiente paso
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}-indicator`).classList.add('active');
                
                // Actualizar botones
                updateButtons();
                
                // Actualizar resumen si estamos en el paso 4
                if (currentStep === 4) {
                    updateSummary();
                }
            } else {
                // Confirmar cita
                confirmAppointment();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                // Ocultar paso actual
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}-indicator`).classList.remove('active');
                
                // Mostrar paso anterior
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}-indicator`).classList.remove('completed');
                document.getElementById(`step${currentStep}-indicator`).classList.add('active');
                
                if (currentStep < 4) {
                    document.getElementById(`line${currentStep}`).classList.remove('completed');
                }
                
                // Actualizar botones
                updateButtons();
            }
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const nextBtnText = document.getElementById('nextBtnText');
            
            // Botón anterior
            prevBtn.style.display = currentStep === 1 ? 'none' : 'flex';
            
            // Botón siguiente/confirmar
            if (currentStep === 4) {
                nextBtnText.textContent = 'Confirmar Cita';
            } else {
                nextBtnText.textContent = 'Siguiente';
            }
            
            updateNextButton();
        }

        function updateSummary() {
            if (selectedPet && selectedService) {
                const service = services[selectedService];
                
                // Actualizar datos en el resumen
                document.getElementById('summaryPet').textContent = selectedPet === 'max' ? 'Max - Golden Retriever' : 'Luna - Siamés';
                document.getElementById('summaryService').textContent = service.name;
                document.getElementById('summaryDate').textContent = selectedDate || '15 de Junio, 2025';
                document.getElementById('summaryTime').textContent = selectedTime || '10:30 AM';
                document.getElementById('summaryDuration').textContent = service.duration;
                document.getElementById('summaryVet').textContent = service.vet;
                document.getElementById('summaryPrice').textContent = `$${service.price.toLocaleString()}`;
            }
        }

        function confirmAppointment() {
            Swal.fire({
                title: 'Confirmando Cita...',
                text: 'Por favor espera mientras procesamos tu solicitud',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Simular proceso de confirmación
            setTimeout(() => {
                Swal.fire({
                    title: '¡Cita Agendada Exitosamente!',
                    html: `
                        <div style="text-align: center;">
                            <div style="font-size: 4rem; margin: 20px 0;">✅</div>
                            <p style="margin-bottom: 20px;">Tu cita ha sido programada correctamente.</p>
                            <div style="background: #ECFDF5; border: 1px solid #A7F3D0; border-radius: 8px; padding: 15px; margin: 20px 0;">
                                <p style="color: #065F46; margin: 0; font-size: 0.9rem;">
                                    <strong>📧 Confirmación enviada:</strong> Recibirás un correo y SMS con los detalles de tu cita.
                                </p>
                            </div>
                            <p style="color: #6B7280; font-size: 0.9rem;">
                                <strong>Número de Cita:</strong> #VET${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}
                            </p>
                        </div>
                    `,
                    icon: 'success',
                    showDenyButton: true,
                    confirmButtonText: 'Ver Mis Citas',
                    denyButtonText: 'Ir al Dashboard',
                    confirmButtonColor: '#2E7D5E',
                    denyButtonColor: '#3B82F6'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '../client/appointments.html';
                    } else if (result.isDenied) {
                        window.location.href = '../client/dashboard.html';
                    }
                });
            }, 3000);
        }

        function showRegisterPet() {
            Swal.fire({
                title: 'Registrar Nueva Mascota',
                text: 'Para registrar una nueva mascota, ve a tu perfil y agrega la información.',
                icon: 'info',
                showCancelButton: true,
                confirmButtonText: 'Ir al Perfil',
                cancelButtonText: 'Continuar Aquí',
                confirmButtonColor: '#2E7D5E'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '../client/profile.html';
                }
            });
        }

        function previousMonth() {
            // Implementar navegación de calendario
            console.log('Previous month');
        }

        function nextMonth() {
            // Implementar navegación de calendario
            console.log('Next month');
        }

        // Generar calendario
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const days = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            
            // Headers
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Days (simplified)
            for (let i = 1; i <= 30; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day available';
                dayElement.textContent = i;
                dayElement.onclick = () => selectDate(i);
                
                if (i < 8) {
                    dayElement.classList.add('unavailable');
                    dayElement.onclick = null;
                }
                
                if (i === 8) {
                    dayElement.classList.add('today');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function selectDate(day) {
            if (event.target.classList.contains('unavailable')) return;
            
            // Remover selección previa
            document.querySelectorAll('.calendar-day').forEach(dayEl => {
                dayEl.classList.remove('selected');
            });
            
            // Seleccionar nueva fecha
            event.target.classList.add('selected');
            selectedDate = `${day} de Junio, 2025`;
            
            // Habilitar botón siguiente
            updateNextButton();
        }

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
            updateButtons();
            
            // Check for URL parameters (for editing)
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('edit');
            const focus = urlParams.get('focus');
            const preService = urlParams.get('service');
            const prePet = urlParams.get('pet');
            
            if (preService) {
                selectedService = preService;
            }
            
            if (prePet) {
                selectedPet = prePet;
            }
            
            if (editId) {
                // Modo edición
                document.querySelector('.page-title').textContent = 'Editar Cita';
                document.querySelector('.page-subtitle').textContent = 'Modifica los detalles de tu cita veterinaria';
            }
        });
    </script>
</body>
</html>